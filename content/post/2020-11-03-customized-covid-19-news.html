---
title: "Customized Covid-19 news (update)"
author: "Ian D. Gow"
date: '2020-11-03'
output:
  html_document:
    df_print: paged
categories: []
tags: []
slug: customized-covid-19-news-update
---

<script src="/blog/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>This is an update of an <a href="2020-06-09-customized-covid-19-news.html">earlier post</a>.</p>
<p>The two key data variables are <em>cases</em> and <em>deaths</em>. As a measure of progress of the pandemic, cases are a more timely statistic than deaths (and also a little less morbid), but there are by-now-well-understood issues with cases, such as under-reporting due to lack of symptoms, or symptoms insufficiently serious to lead to hospitalization or testing. As pointed out in <a href="https://www.wsj.com/articles/california-and-some-other-states-see-coronavirus-cases-rise-11591540411?shareToken=st8ed170060eaf4b31aa5852c0d23e3691">the <em>WSJ</em> article</a> linked to above, as testing capacity increases, we might expect to see a rise in reported cases, even if the underlying number of cases is flat.</p>
<div id="getting-the-data" class="section level2">
<h2>Getting the data</h2>
<p>Getting the data is quite easy.</p>
<pre class="r"><code>library(readr)
library(lubridate)
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
library(RcppRoll)

raw &lt;- read_csv(paste0(&quot;https://raw.githubusercontent.com/&quot;,
                       &quot;nytimes/covid-19-data/master/us-states.csv&quot;))

covid_world_raw &lt;- read_csv(paste0(&quot;https://covid.ourworldindata.org&quot;,
                               &quot;/data/owid-covid-data.csv&quot;),
                            col_types = cols(.default = col_guess(),
                                             new_tests = col_double(),
                                             new_tests_smoothed = col_double(),
                                             new_tests_smoothed_per_thousand = col_double(),
                                             tests_per_case =  col_double(),
                                             positive_rate =  col_double(),
                                             total_tests = col_double(),
                                             total_tests_per_thousand = col_double(),
                                             new_tests_per_thousand = col_double(),
                                             weekly_hosp_admissions = col_double(),
                                             weekly_hosp_admissions_per_million = col_double(),
                                             weekly_icu_admissions = col_double(),
                                             weekly_icu_admissions_per_million = col_double(),
                                             icu_patients = col_double(),
                                             icu_patients_per_million = col_double(),
                                             hosp_patients = col_double(),
                                             hosp_patients_per_million = col_double(),
                                             tests_units = col_character()))

covid_states &lt;-
  raw %&gt;%
  group_by(state) %&gt;%
  arrange(date) %&gt;%
  mutate(new_cases = cases - lag(cases),
         new_deaths = deaths - lag(deaths)) %&gt;%
  rename(total_deaths = deaths,
         total_cases = cases)</code></pre>
<p>Initially, I wanted to consider Australia as a US state for the purpose of comparison. For the US, I focused on a few states of interest: New York was the worst-hit state, Massachusetts is where I am now, and California is the most populous state. Pennsylvania provides an interesting comparison for Massachusetts. Apart from Australia, I also considered the United Kingdom, which was hit at about the same time as New York.</p>
<pre class="r"><code>selected_states &lt;- c(&quot;Massachusetts&quot;, &quot;New York&quot;, &quot;Pennsylvania&quot;, &quot;California&quot;)
selected_countries &lt;- c(&quot;AUS&quot;, &quot;GBR&quot;)

covid_aus_usa &lt;-
  covid_world_raw %&gt;%
  filter(iso_code %in% selected_countries) %&gt;%
  select(location:new_deaths) %&gt;%
  rename(state = location)
  
covid_selected &lt;-
  covid_states %&gt;%
  filter(state %in% selected_states) %&gt;%
  union_all(covid_aus_usa)</code></pre>
<div id="cases" class="section level3">
<h3>Cases</h3>
<p>One thing I noticed initially was a definite lumpiness to the data (e.g., many more deaths on Tuesdays rather than Sundays in Pennsylvania), which I assume is down to reporting rather than actual events. Initially, I used a four-day moving average, but here I use a seven-day moving average (as the four-day one still showed clean peaks and valleys).</p>
<pre class="r"><code>covid_selected %&gt;%
  group_by(state) %&gt;%
  arrange(date) %&gt;%
  mutate(new_cases = roll_meanr(new_cases, n = 7, fill = NA)) %&gt;%
  filter(!is.na(new_cases)) %&gt;%
  ggplot(aes(x = date, y = new_cases, color = state)) +
  geom_line() +
  scale_x_date(breaks = &quot;8 weeks&quot;)</code></pre>
<p><img src="/blog/post/2020-11-03-customized-covid-19-news_files/figure-html/plot_cases-1.png" width="672" /></p>
</div>
<div id="deaths" class="section level3">
<h3>Deaths</h3>
<pre class="r"><code># So use a seven-day rolling average
covid_selected %&gt;%
  group_by(state) %&gt;%
  arrange(date) %&gt;%
  mutate(new_deaths = roll_meanr(new_deaths, n = 7, fill = NA)) %&gt;%
  filter(!is.na(new_deaths)) %&gt;%
  ggplot(aes(x = date, y = new_deaths, color = state)) +
  geom_line() +
  scale_x_date(breaks = &quot;8 weeks&quot;)</code></pre>
<p><img src="/blog/post/2020-11-03-customized-covid-19-news_files/figure-html/plot_deaths-1.png" width="672" /></p>
</div>
</div>
